# Salt Edge Compliance Connector Java Example & SDK (v1) [DEPRECATED]

This codebase was created to demonstrate a full-stack application built on Spring Boot, destinated to support communication between ASPSP and Priora Compliance Solution. Current application implements Priora Connector v1 API.
Consist of modules:
* **Example Application**
* **Connector SDK v1**
  
## Application Requirements
  
1. JDK, at least version 8 
1. Spring Boot Framework, at least version 2.2.0
1. Registration & API Keys  
   Follow the guide on how to [register and add API keys](https://priora.saltedge.com/connector-docs#registration-api-keys)

## Example Application Quick Setup

1. Clone project
1. Navigate to project's root folder
    ```bash
    cd saltedge-compliance-connector-java
    ```
1. Create configuration files
    ```bash
    cp example/src/main/resources/application.example.yml example/src/main/resources/application.yml
    cp example/src/main/resources/application.example.properties example/src/main/resources/application.properties
    ```
1. Add secret keys  
    You can generate your RSA key pair using this commands: 
    ```bash
    openssl genrsa -out connector_private_prod.pem 2048
    openssl rsa -pubout -in connector_private_prod.pem -out connector_public_prod.pem
    ```
   > Notice that you must save the content of `connector_public_prod.pem` in your Provider [Dashboard/Settings](https://priora.saltedge.com/providers/settings).
   
   After following the step above, be sure to save your private key generated by openssl in `example/src/main/resources` folder.  
1. Edit configuration files  
    * Example application uses a H2 in memory database (for now), can be changed easily in the `application.properties` for any other database type.
    * Set your external host name in `application.properties`
      ```yaml
      app.url=http://123456789.ngrok.io
      ```
1. Set your external host name in `application.properties`
  ```yaml
  app.url=http://my_host.org
  ``` 

## SDK Integration

1. Add SDK to target application as Module or as JAR library (`out/saltedge-connector-sdk-1.0.0-all.jar`);
1. Setup application as [described before](#example-application-quick-setup)
1. Add SDK package (`com.saltedge.connector.sdk`) to component scan annotation in Application class.
    ```java
    @SpringBootApplication(scanBasePackages = {EXAMPLE_PACKAGE, CONNECTOR_PACKAGE})
    @EnableJpaRepositories(basePackages = {EXAMPLE_PACKAGE, CONNECTOR_PACKAGE})
    @EntityScan(basePackages = {EXAMPLE_PACKAGE, CONNECTOR_PACKAGE})
    public class ExampleApplication {
       public static final String CONNECTOR_PACKAGE = "com.saltedge.connector.sdk";
       
    }
    ```
1. Add `extra` field to `Payment` entity (if not exist) for storing extra data from Salt Edge Compliance solution (e.g. prioraPaymentId).
1. Create a service which will provide required by Priora data and receive data from Priora:
    * Service should implement `ProviderApi` interface and should have `@Service` annotation;
    * `getProviderCode()` should return code registered in [Connection Details](https://priora.saltedge.com/providers/settings#details);
    * `getProviderName()` should return name registered in [Connection Details](https://priora.saltedge.com/providers/settings#details);
    * `getAuthorizationTypes(...)` should return list of registered [Authorization types](https://priora.saltedge.com/providers/settings#authorization_types);
    * `getAuthorizationPageUrl()` should return URL of authorization page for oAuth authorization type;
    * `confirmationCodeRequired(...)` should return generated confirmation code and send it via available channel (e.g. SMS);
    * `authorizeUser(...)` should return authorize user by provided credentials and return user id;
    * `getKyc(...)` should return KYC data;
    * `getAccounts(...)` should return accounts list;
    * `getTransactions(...)` should return transactions list for account;
    * `getPaymentTemplates(...)` should return list of registered [Payment templates](https://priora.banksalt.com/providers/templates);
    * `getPaymentTemplateByCode(...)`
    * `createPayment(...)` initiate payment creation;
    * `isPaymentConfirmed(...)` check of payment is confirmed or not;
    * `getPaymentConfirmationPageUrl()` should return URL of confirm page for oAuth authorization type;
    * `getPaymentData(...)` should return Payment data;
    * `confirmPayment(...)` confirm payment;
    * `cancelPayment(...)` cancel payment.  
   
1. Use SDK callback service `ProviderCallback` for some events: 
    * On oAuth (`redirect`) authorization success, call method `authorizationOAuthSuccess(sessionSecret, userId)` of `ProviderCallback` for token confirmation
    ```java
    @Autowired
    ProviderCallback providerCallback;
    
    providerCallback.authorizationOAuthSuccess(secret, userId)
    ```
    
    * On oAuth (`redirect`) authorization error, call method `authorizationOAuthError(sessionSecret, errorMessage)` of `ProviderCallback`
    ```java
    @Autowired
    ProviderCallback providerCallback;
    
    providerCallback.authorizationOAuthError(secret, errorMessage)
    ```
    
    * On oAuth (`redirect`) payment confirmation success, call method `paymentConfirmationOAuthSuccess(paymentId, paymentExtra)` of `ProviderCallback`
    ```java
    @Autowired
    ProviderCallback providerCallback;
    
    providerCallback.paymentConfirmationOAuthSuccess(paymentId, paymentExtra)
    ```

---
## [LICENSE](LICENSE.txt)

---
Copyright Â© 2020 Salt Edge. https://www.saltedge.com